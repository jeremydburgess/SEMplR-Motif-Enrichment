% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/getCoordinates.R
\name{getCoordinates}
\alias{getCoordinates}
\title{Retrieve Promoter Regions and Sample Background Elements}
\usage{
getCoordinates(
  mapped,
  transcript = FALSE,
  TSS.method = c("UCSCgene", "Ensembl_canonical", "commonTSS", "uniqueTSS",
    "fivePrimeTSS", "allTSS"),
  bgMethod = c("pool", "random", "matched"),
  n_ratio = 1,
  bgExcludeFgOverlaps = TRUE,
  bgExcludeFgGenes = FALSE,
  covariates = c("width", "gc", "chromosome"),
  bgReplace = FALSE,
  seed = NULL,
  nrMethod = c("rejection", "nearest", "stratified"),
  bsGenome = NULL,
  promoterWindow = c(upstream = 300, downstream = 50),
  standardChroms = TRUE,
  reduceOverlaps = TRUE,
  overlapMinGap = 0,
  onePromoterPerGene = TRUE,
  ensDb = NULL
)
}
\arguments{
\item{mapped}{A list as returned by \code{\link{mapForegroundIDs}()}, containing
at least \code{fg_ids}, \code{bg_ids}, \code{so_obj}, \code{orgdb},
\code{genomeBuild}, and \code{organism}.}

\item{transcript}{Logical; \code{TRUE} for transcript‐level coordinates,
\code{FALSE} for gene‐level.}

\item{TSS.method}{Character(1). Method to pick TSS when \code{transcript=FALSE}:
\code{"UCSCgene"}, \code{"Ensembl_canonical"}, \code{"commonTSS"},
\code{"uniqueTSS"}, \code{"fivePrimeTSS"}, or \code{"allTSS"}.}

\item{bgMethod}{Character; one of \code{"pool"}, \code{"random"}, or
\code{"matched"}. Passed to \code{\link{helper_defineBackgroundElements}()}.}

\item{n_ratio}{Numeric; for \code{bgMethod="random"}, number of backgrounds =
\code{n_ratio * length(foreground)}.}

\item{bgExcludeFgOverlaps}{Logical; if \code{TRUE}, drop any background whose
promoter overlaps a foreground.}

\item{bgExcludeFgGenes}{Logical; if \code{TRUE}, drop any background gene
whose EntrezID is in the foreground.}

\item{covariates}{Character vector of covariate names for matching:
\code{"width"}, \code{"gc"}, \code{"seqnames"} (or \code{"chromosome"}), or
any user‐provided \code{mcols()} column.}

\item{bgReplace}{Logical; allow replacement when sampling backgrounds.}

\item{seed}{Integer; optional random seed.}

\item{nrMethod}{Character; \code{"rejection"}, \code{"nearest"}, or
\code{"stratified"}. Passed to \code{\link{helper_defineBackgroundElements}()}.}

\item{bsGenome}{A \pkg{BSgenome} object. If \code{NULL} and \code{"gc"} is in
\code{covariates}, will be auto‐resolved via \code{\link{helper_resolveBSgenome}()}.}

\item{promoterWindow}{Numeric named vector of lengths:
\code{c(upstream, downstream)} (default \code{c(300,50)}).}

\item{standardChroms}{Logical; restrict to standard chromosomes.}

\item{reduceOverlaps}{Logical; merge any overlapping promoter windows.}

\item{overlapMinGap}{Numeric; minimum gap when reducing overlaps.}

\item{onePromoterPerGene}{Logical; if \code{TRUE}, choose one promoter per gene.}

\item{ensDb}{Optional \code{EnsDb} object; required for
\code{TSS.method="Ensembl_canonical"}.}
}
\value{
A named \code{list} from the final \code{helper_defineBackgroundElements()}:
\item{backgroundElements}{\code{GRanges} of sampled background promoters}
\item{foregroundElements}{\code{GRanges} of foreground promoters}
\item{backgroundUniverse}{\code{GRanges} of the pruned universe}
\item{matchObject}{\code{MatchedGRanges} if \code{bgMethod="matched"}, else \code{NULL}}
}
\description{
Given a mapped set of foreground IDs (with Entrez and mappedID),
this function:
\enumerate{
\item Fetches genomic coordinates for each feature (gene or transcript), according
to the chosen \code{TSS.method}.
\item Extracts promoter windows around those coordinates.
\item Optionally reduces overlaps and selects one promoter per gene.
\item Samples background promoter elements matching the foreground, via
\code{\link{helper_defineBackgroundElements}()}.
}
}
\examples{
\dontrun{
mapping <- buildMappingObject("Homo sapiens")
mapped  <- mapForegroundIDs(my_ids, mapping)
filtered <- poolFilter(mapped, geneType="protein-coding")
coords <- getCoordinates(
  filtered,
  transcript     = FALSE,
  TSS.method     = "UCSCgene",
  bgMethod       = "matched",
  n_ratio        = 1,
  covariates     = c("width","gc","chromosome"),
  nrMethod       = "stratified",
  bsGenome       = BSgenome.Hsapiens.UCSC.hg38,
  promoterWindow = c(upstream=300, downstream=50)
)
}

}
