% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/helper_matchBackground.R
\name{helper_matchBackground}
\alias{helper_matchBackground}
\title{Match Background Regions to Foreground by Key Covariates}
\usage{
helper_matchBackground(
  pool,
  focal,
  organism,
  genomeBuild,
  bsgenome,
  covariates,
  nrMethod,
  bgReplace,
  seed
)
}
\arguments{
\item{pool}{A \code{GRanges} of pruned background candidate regions.}

\item{focal}{A \code{GRanges} of foreground regions to match.}

\item{organism}{Character(1). Species name (e.g. "Homo sapiens"),
used to resolve a BSgenome if \code{gc} is requested.}

\item{genomeBuild}{Character(1). UCSC‐style genome build (e.g. "hg38").}

\item{bsgenome}{A loaded BSgenome object (e.g. \code{BSgenome.Hsapiens.UCSC.hg38}).
If NULL and \code{gc} is in \code{covariates}, the helper will attempt to resolve one.}

\item{covariates}{Character vector of columns to match on. Valid values:
\itemize{
\item "width" → injected as \code{promoterWidth}
\item "seqnames" or "chromosome" → injected as \code{chromosome}
\item "gc" → computed from \code{bsgenome}
\item any other existing \code{mcols(pool)} column provided by the user
}}

\item{nrMethod}{Character(1). Sampling algorithm passed to
\code{\link[nullranges]{matchRanges}()}: \code{"rejection"} or \code{"stratified"}.}

\item{bgReplace}{Logical. Allow replacement when sampling background
(defaults to FALSE). If \code{nrMethod = "nearest"}, replacement is forced TRUE.}

\item{seed}{Integer. Optional random seed for reproducibility (default NULL).}
}
\value{
A \code{MatchRanges} object, containing:
\itemize{
\item \code{matched(mgr)}: the matched background \code{GRanges}
\item \code{focal(mgr)}: the foreground \code{GRanges}
\item \code{pool(mgr)}: the pruned background universe
\item \code{unmatched(mgr)}: any focal regions that failed to match
}
}
\description{
Uses \pkg{nullranges} to select a 1:1 background set that matches the
foreground on specified covariates (e.g. binned width, GC content, chromosome).
}
\note{
When using \code{nrMethod = "rejection"}, continuous covariates like promoter width
often have very low variance (e.g. many regions exactly 350 bp), which can break
the kernel‐density–based sampler. To match on width, first \strong{bin} it into
categories (e.g. quartiles) so it is treated as a factor. Otherwise, omit width
or use \code{nrMethod = "stratified"}.
}
\examples{
\dontrun{
library(BSgenome.Hsapiens.UCSC.hg38)
mgr <- helper_matchBackground(
  pool       = prom_bg,
  focal      = prom_fg,
  organism   = "Homo sapiens",
  genomeBuild= "hg38",
  bsgenome   = BSgenome.Hsapiens.UCSC.hg38,
  covariates = c("width", "gc", "chromosome"),
  nrMethod   = "rejection",
  bgReplace  = FALSE,
  seed       = 42
)
# extract the GRangesList of fg+bg:
GRangesList(
  foregroundElements = nullranges::focal(mgr),
  backgroundElements = nullranges::matched(mgr)
)
}

}
